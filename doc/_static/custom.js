/**
 * Customize script for the HTML which is generated by the Sphinx.
 */

/////////////////////////////////////////////////////////////////////////////
/**
 * Add viewer.js
 */
(function() {
  let link = document.createElement("link");
  link.setAttribute("rel", "stylesheet");
  link.setAttribute("href", "https://cdnjs.cloudflare.com/ajax/libs/viewerjs/1.10.5/viewer.min.css");
  link.setAttribute("integrity", "sha512-3NbO5DhK9LuM6wu+IZvV5AYXxqSmj/lfLLmHMV9t18ij+MfmhhxeYEunHllEu+TFJ4tJM5D0DhazM2EGGGvNmQ==");
  link.setAttribute("crossorigin", "anonymous");
  link.setAttribute("referrerpolicy", "referrer");
  document.head.appendChild(link);
  let script = document.createElement("script");
  script.setAttribute("src","https://cdnjs.cloudflare.com/ajax/libs/viewerjs/1.10.5/viewer.min.js");
  script.setAttribute("integrity","sha512-i5q29evO2Z4FHGCO+d5VLrwgre/l+vaud5qsVqQbPXvHmD9obORDrPIGFpP2+ep+HY+z41kAmVFRHqQAjSROmA==");
  script.setAttribute("crossorigin", "anonymous");
  script.setAttribute("referrerpolicy", "referrer");
  document.head.appendChild(script);
})()

window.addEventListener("load", function(){
  new Viewer(document.body);
  let e = document.querySelectorAll("img");
  false && [].forEach.call(e, function(e){
    new Viewer(e);
  });
});

window.addEventListener("DOMContentLoaded", function(){
  /////////////////////////////////////////////////////////////////////////////
  /**
   * Add "Copy to the clipboard button" to code-block "forCnP" of reStructuredText.
   */
//  let forCnPs =	document.querySelectorAll(".highlight-forCnP");
  let forCnPs =	document.querySelectorAll(".forcnp");
  [].forEach.call(forCnPs, function(e){
    let pre = e.querySelector("pre");
//    let copy = pre.parentNode.insertBefore(document.createElement("input"), pre.nextSibling);
    let copy = e.appendChild(document.createElement("input"));
//    let copy = e.insertBefore(document.createElement("input"), e.firstChild);
    Object.assign(copy, {type: "button", title: "Copy above commands to the Clipboard", value: "Copy"});
    copy.addEventListener("click", function(){
        let txt = pre.textContent;
        txt = txt.replace(/\r\n|\n/g,"\r\n");
        console.log(txt);
      navigator.clipboard.writeText(txt);
    });
  });
});
